STMicroelectronics list file postprocessor v1.01   (C)2009-2015   Sat Jun 13 19:44:33 2015
Page 1  Assembler
                                               d:\stm\blink_test\main.asm

   1                         stm8/     
   2                                   
   0  000000                                 #include "mapping.inc"    
   1                                                          ;-------------------------------
                                                                ;-----------------------
   2                                                          ; SEGMENT MAPPING FILE 
                                                                ;AUTOMATICALLY GENERATED BY 
                                                                ;STVD
   3                                                          ; SHOULD NOT BE MANUALLY 
                                                                ;MODIFIED.
   4                                                          ; CHANGES WILL BE LOST WHEN FILE
                                                                ; IS REGENERATED.
   5                                                          ;-------------------------------
                                                                ;-----------------------
   6  000000                                 #define  RAM0 1
   7  000000                                 #define  ram0_segment_start 0
   8  000000                                 #define  ram0_segment_end FF
   9  000000                                 #define  RAM1 1
  10  000000                                 #define  ram1_segment_start 100
  11  000000                                 #define  ram1_segment_end 1FF
  12  000000                                 #define  stack_segment_start 200
  13  000000                                 #define  stack_segment_end 3FF
<END_OF_INCLUSION>
   4                                   
   5                                   segment  'rom'
   6                                   
   7  0050C6                       CLK_CKDIVR  EQU      $50C6          ; Clock divider register
   8  00500A                       PD_ODR    EQU      $500A          ; Port D data output latch 
                                                                ;register
   9  00500C                       PD_DDR    EQU      $500C          ; Port D data direction 
                                                                ;register
  10                         
  11  005300                       TIM2_CR1  EQU      $5300          ; TIM2 Control register 1
  12  005303                       TIM2_IER  EQU      $5303          ; TIM2 Interrupt enable 
                                                                ;register
  13  005304                       TIM2_SR1  EQU      $5304          ; TIM2 Status register 1
  14  00530E                       TIM2_PSCR  EQU      $530E          ; TIM2 Prescaler register
  15  00530F                       TIM2_ARRH  EQU      $530F          ; Auto Refresh High
  16  005310                       TIM2_ARRL  EQU      $5310          ; Auto Refresh Low
  17                         
  18                         start     
  19                         
  20  008080   350050C6                      mov      CLK_CKDIVR,#$0                      ; set max internal clock
  21                         
  22  008084   AE03FF                        ldw      X,#$3FF       ; initialize SP
  23  008087   94                            ldw      SP,X
  24                                   
  25  008088   AE0000                        ldw      X,#$0         ; clear all the ram
  26                         clear_ram  
  27  00808B   7F                            clr      (X)
  28  00808C   5C                            incw     X
  29  00808D   A303FF                        cpw      X,#$3FF
  30  008090   23F9                          jrule    clear_ram
  31                         ; now it is now safe to use the stack
  32                         
  33                         ; init our program
  34  008092   721E500C                      bset     PD_DDR,#7              ;PD0 is set to output mode      
                                                                ;              
STMicroelectronics list file postprocessor v1.01   (C)2009-2015   Sat Jun 13 19:44:33 2015
Page 2  Assembler
                                               d:\stm\blink_test\main.asm

  35                         
  36                         ; init timer 2
  37  008096   3504530E                      mov      TIM2_PSCR,#$04           ;timer 2 prescaler div by 32768
  38  00809A   3500530F                      mov      TIM2_ARRH,#$00           ;msb must be loaded first 
  39  00809E   35085310                      mov      TIM2_ARRL,#$08           ;we need 488 decimal (0x01E8 for
                                                                ; about 1hz 
  40  0080A2   72105303                      bset     TIM2_IER,#0             ;set bit 0 for update irq's on 
                                                                ;irq13
  41  0080A6   72105300                      bset     TIM2_CR1,#0             ;set CEN bit to enable the 
                                                                ;timer
  42                                   
  43  0080AA   9A                            rim                    ;reset the cpu interupt mask
  44                         ; main program loop
  45                         loop_forever  
  46                                                          ;wfi                       
                                                                ;;uncomment this to wait for 
                                                                ;interrupts
  47                                                          ;for lower power, causes 
                                                                ;problems with
  48                                                          ;the debugger when used.
  49  0080AB   20FE                          jra      loop_forever
  50                         
  51                         ; Timer 2 update interrupt handler
  52  0080AD                                 interrupt Timer2UpdateInterupt
  53                         Timer2UpdateInterupt  
  54  0080AD   72115304                      bres     TIM2_SR1,#0           ;reset interrupt flag
  55  0080B1   901E500A                      bcpl     PD_ODR,#7    
  56  0080B5   80                            iret     
  57                                   
  58                                   
  59                         ; The default interupt handler
  60  0080B6                                 interrupt NonHandledInterrupt
  61                         NonHandledInterrupt  
  62  0080B6   80                            iret     
  63                         
  64                         ; the interrupt table
  65                                   segment  'vectit'
  66  008000   82008080                      dc.l     {$82000000+start}                                  ; reset
  67  008004   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; trap
  68  008008   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq0 TLI External top level 
                                                                ;interrupt
  69  00800C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq1 AWU Auto wake up from 
                                                                ;halt
  70  008010   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq2 CLK Clock Controller
  71  008014   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq3 EXTIO Port A external
  72  008018   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq4 EXTI1 Port B
  73  00801C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq5 EXTI2 Port C
  74  008020   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq6 EXTI3 Port D
  75  008024   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq7 EXTI4 Port E external 
  76  008028   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq8  reserved
  77  00802C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq9  reserved
  78  008030   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq10 SPI end of transfer
  79  008034   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq11 TIM1 
                                                                ;Update/overflow/underflow/trigg
                                                                ;er/break
  80  008038   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq12 TIM1 Capture/Compare
  81  00803C   820080AD                      dc.l     {$82000000+Timer2UpdateInterupt}     ; irq13 TIM2 update/overflow
STMicroelectronics list file postprocessor v1.01   (C)2009-2015   Sat Jun 13 19:44:33 2015
Page 3  Assembler
                                               d:\stm\blink_test\main.asm

  82  008040   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq14 TIM2 capture / compare
  83  008044   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq15 TIM3 Update/ overflow
  84  008048   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq16 TIM3 Capture / Compare
  85  00804C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq17 reserved
  86  008050   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq18 reserved
  87  008054   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq19 I2C
  88  008058   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq20 Uart2 Tx Complete
  89  00805C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq21 Uart2 Receive Register 
                                                                ;Data Full
  90  008060   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq22 ADC1 end of conversion
  91  008064   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq23 TIM4 Update/Overflow
  92  008068   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq24 Flash EOP/WR_PG_DIS
  93  00806C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq25 reserved
  94  008070   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq26 reserved
  95  008074   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq27 reserved
  96  008078   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq28 reserved
  97  00807C   820080B6                      dc.l     {$82000000+NonHandledInterrupt}      ; irq29 reserved
  98                         
  99  008080                                 end      
STMicroelectronics list file postprocessor v1.01   (C)2009-2015   Sat Jun 13 19:44:33 2015
Page 4  Assembler
                                               d:\stm\blink_test\main.asm

Symbol Name                       Value     Call       Type  Scope      Rel.  Line  Privacy  Segment   Size  Bytes File

CLK_CKDIVR                            50C6         no  WORD  Internal   ABS      7  private  text         0     0  -

NonHandledInterrupt                   80B6  interrupt  WORD  Internal   ABS     61  private  text         1     0  -

PD_ODR                                500A         no  WORD  Internal   ABS      8  private  text         0     0  -
PD_DDR                                500C         no  WORD  Internal   ABS      9  private  text         0     0  -

TIM2_CR1                              5300         no  WORD  Internal   ABS     11  private  text         0     0  -
TIM2_IER                              5303         no  WORD  Internal   ABS     12  private  text         0     0  -
TIM2_SR1                              5304         no  WORD  Internal   ABS     13  private  text         0     0  -
TIM2_PSCR                             530E         no  WORD  Internal   ABS     14  private  text         0     0  -
TIM2_ARRH                             530F         no  WORD  Internal   ABS     15  private  text         0     0  -
TIM2_ARRL                             5310         no  WORD  Internal   ABS     16  private  text         0     0  -
Timer2UpdateInterupt                  80AD  interrupt  WORD  Internal   ABS     53  private  text         9     0  -

clear_ram                             808B         no  WORD  Internal   ABS     26  private  text        32     0  -

loop_forever                          80AB         no  WORD  Internal   ABS     45  private  text         2     0  -

start                                 8080         no  WORD  Internal   ABS     18  private  text        11     0  -


14 labels
No errors on assembly of 'd:\stm\blink_test\main.asm'