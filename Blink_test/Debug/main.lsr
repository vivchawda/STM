STMicroelectronics assembler v4.52   (C)1987-2015   Wed Jun 03 23:15:43 2015
Page 1  Assembler
                                               d:\stm\blink_test\main.asm

   1                         stm8/     
   2                                   
   0  000000                                 #include "mapping.inc"    
   1                                                          ;-------------------------------
                                                                ;-----------------------
   2                                                          ; SEGMENT MAPPING FILE 
                                                                ;AUTOMATICALLY GENERATED BY 
                                                                ;STVD
   3                                                          ; SHOULD NOT BE MANUALLY 
                                                                ;MODIFIED.
   4                                                          ; CHANGES WILL BE LOST WHEN FILE
                                                                ; IS REGENERATED.
   5                                                          ;-------------------------------
                                                                ;-----------------------
   6  000000                                 #define  RAM0 1
   7  000000                                 #define  ram0_segment_start 0
   8  000000                                 #define  ram0_segment_end FF
   9  000000                                 #define  RAM1 1
  10  000000                                 #define  ram1_segment_start 100
  11  000000                                 #define  ram1_segment_end 1FF
  12  000000                                 #define  stack_segment_start 200
  13  000000                                 #define  stack_segment_end 3FF
<END_OF_INCLUSION>
   4                                   
   5                                   segment  'rom'
   6                                   
   7  0050C6                       CLK_CKDIVR  EQU      $50C6          ; Clock divider register
   8  00500A                       PD_ODR    EQU      $500A          ; Port D data output latch 
                                                                ;register
   9  00500C                       PD_DDR    EQU      $500C          ; Port D data direction 
                                                                ;register
  10                         
  11  005300                       TIM2_CR1  EQU      $5300          ; TIM2 Control register 1
  12  005303                       TIM2_IER  EQU      $5303          ; TIM2 Interrupt enable 
                                                                ;register
  13  005304                       TIM2_SR1  EQU      $5304          ; TIM2 Status register 1
  14  00530E                       TIM2_PSCR  EQU      $530E          ; TIM2 Prescaler register
  15  00530F                       TIM2_ARRH  EQU      $530F          ; Auto Refresh High
  16  005310                       TIM2_ARRL  EQU      $5310          ; Auto Refresh Low
  17                         
  18                         start     
  19                         
  20  000000   350050C6                      mov      CLK_CKDIVR,#$0                      ; set max internal clock
  21                         
  22  000004   AE03FF                        ldw      X,#$3FF       ; initialize SP
  23  000007   94                            ldw      SP,X
  24                                   
  25  000008   AE0000                        ldw      X,#$0         ; clear all the ram
  26                         clear_ram  
  27  00000B   7F                            clr      (X)
  28  00000C   5C                            incw     X
  29  00000D   A303FF                        cpw      X,#$3FF
  30  000010 R 23F9                          jrule    clear_ram
  31                         ; now it is now safe to use the stack
  32                         
  33                         ; init our program
  34  000012   721E500C                      bset     PD_DDR,#7              ;PD0 is set to output mode      
                                                                ;              
STMicroelectronics assembler v4.52   (C)1987-2015   Wed Jun 03 23:15:43 2015
Page 2  Assembler
                                               d:\stm\blink_test\main.asm

  35                         
  36                         ; init timer 2
  37  000016   3504530E                      mov      TIM2_PSCR,#$04           ;timer 2 prescaler div by 32768
  38  00001A   3500530F                      mov      TIM2_ARRH,#$00           ;msb must be loaded first 
  39  00001E   35085310                      mov      TIM2_ARRL,#$08           ;we need 488 decimal (0x01E8 for
                                                                ; about 1hz 
  40  000022   72105303                      bset     TIM2_IER,#0             ;set bit 0 for update irq's on 
                                                                ;irq13
  41  000026   72105300                      bset     TIM2_CR1,#0             ;set CEN bit to enable the 
                                                                ;timer
  42                                   
  43  00002A   9A                            rim                    ;reset the cpu interupt mask
  44                         ; main program loop
  45                         loop_forever  
  46                                                          ;wfi                       
                                                                ;;uncomment this to wait for 
                                                                ;interrupts
  47                                                          ;for lower power, causes 
                                                                ;problems with
  48                                                          ;the debugger when used.
  49  00002B R 20FE                          jra      loop_forever
  50                         
  51                         ; Timer 2 update interrupt handler
  52  00002D R                               interrupt Timer2UpdateInterupt
  53                         Timer2UpdateInterupt  
  54  00002D   72115304                      bres     TIM2_SR1,#0           ;reset interrupt flag
  55  000031   901E500A                      bcpl     PD_ODR,#7    
  56  000035   80                            iret     
  57                                   
  58                                   
  59                         ; The default interupt handler
  60  000036 R                               interrupt NonHandledInterrupt
  61                         NonHandledInterrupt  
  62  000036   80                            iret     
  63                         
  64                         ; the interrupt table
  65                                   segment  'vectit'
  66  000000 R 00000000                      dc.l     {$82000000+start}                                  ; reset
  67  000004 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; trap
  68  000008 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq0 TLI External top level 
                                                                ;interrupt
  69  00000C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq1 AWU Auto wake up from 
                                                                ;halt
  70  000010 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq2 CLK Clock Controller
  71  000014 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq3 EXTIO Port A external
  72  000018 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq4 EXTI1 Port B
  73  00001C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq5 EXTI2 Port C
  74  000020 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq6 EXTI3 Port D
  75  000024 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq7 EXTI4 Port E external 
  76  000028 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq8  reserved
  77  00002C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq9  reserved
  78  000030 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq10 SPI end of transfer
  79  000034 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq11 TIM1 
                                                                ;Update/overflow/underflow/trigg
                                                                ;er/break
  80  000038 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq12 TIM1 Capture/Compare
  81  00003C R 00000000                      dc.l     {$82000000+Timer2UpdateInterupt}     ; irq13 TIM2 update/overflow
STMicroelectronics assembler v4.52   (C)1987-2015   Wed Jun 03 23:15:43 2015
Page 3  Assembler
                                               d:\stm\blink_test\main.asm

  82  000040 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq14 TIM2 capture / compare
  83  000044 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq15 TIM3 Update/ overflow
  84  000048 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq16 TIM3 Capture / Compare
  85  00004C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq17 reserved
  86  000050 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq18 reserved
  87  000054 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq19 I2C
  88  000058 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq20 Uart2 Tx Complete
  89  00005C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq21 Uart2 Receive Register 
                                                                ;Data Full
  90  000060 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq22 ADC1 end of conversion
  91  000064 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq23 TIM4 Update/Overflow
  92  000068 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq24 Flash EOP/WR_PG_DIS
  93  00006C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq25 reserved
  94  000070 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq26 reserved
  95  000074 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq27 reserved
  96  000078 R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq28 reserved
  97  00007C R 00000000                      dc.l     {$82000000+NonHandledInterrupt}      ; irq29 reserved
  98                         
  99  000080                                 end      
STMicroelectronics assembler v4.52   (C)1987-2015   Wed Jun 03 23:15:43 2015
Page 4  Assembler
                                               d:\stm\blink_test\main.asm

Symbol Name                       Value     Call       Type  Scope      Rel.  Line  Privacy  Segment   Size  Bytes File

CLK_CKDIVR                            50C6         no  WORD  Internal   ABS      7  private  text         0     0  -

NonHandledInterrupt                   0036  interrupt  WORD  Internal   rel     61  private  text         1     0  -

PD_ODR                                500A         no  WORD  Internal   ABS      8  private  text         0     0  -
PD_DDR                                500C         no  WORD  Internal   ABS      9  private  text         0     0  -

TIM2_CR1                              5300         no  WORD  Internal   ABS     11  private  text         0     0  -
TIM2_IER                              5303         no  WORD  Internal   ABS     12  private  text         0     0  -
TIM2_SR1                              5304         no  WORD  Internal   ABS     13  private  text         0     0  -
TIM2_PSCR                             530E         no  WORD  Internal   ABS     14  private  text         0     0  -
TIM2_ARRH                             530F         no  WORD  Internal   ABS     15  private  text         0     0  -
TIM2_ARRL                             5310         no  WORD  Internal   ABS     16  private  text         0     0  -
Timer2UpdateInterupt                  002D  interrupt  WORD  Internal   rel     53  private  text         9     0  -

clear_ram                             000B         no  WORD  Internal   rel     26  private  text        32     0  -

loop_forever                          002B         no  WORD  Internal   rel     45  private  text         2     0  -

start                                 0000         no  WORD  Internal   rel     18  private  text        11     0  -


14 labels
No errors on assembly of 'd:\stm\blink_test\main.asm'